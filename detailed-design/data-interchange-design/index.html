<!doctype html><html lang=en><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0" name=viewport><title>CS 5744 Project 1</title><link href=https://panevain.github.io/CS5744_TransitFlow/book.css rel=stylesheet><link href=https://panevain.github.io/CS5744_TransitFlow/style.css rel=stylesheet><body><div class=menu><h2 class=title-text>TransitFlow</h2><nav role=navigation><ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/introduction/> <strong>1.</strong> Introduction </a> <ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/introduction/background/> <strong>1.1.</strong> Background </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/introduction/goals/> <strong>1.2.</strong> Goals </a></ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/requirements/> <strong>2.</strong> Requirements </a> <ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/requirements/use-cases/> <strong>2.1.</strong> Use Cases </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/requirements/stakeholder-analysis/> <strong>2.2.</strong> Stakeholder Analysis </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/requirements/functional/> <strong>2.3.</strong> Functional Requirements </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/requirements/non-functional/> <strong>2.4.</strong> Non-Functional Requirements </a></ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/high-level-design/> <strong>3.</strong> High Level Design </a> <ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/high-level-design/top-level-architecture/> <strong>3.1.</strong> Top Level Architecture </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/high-level-design/traceability-matrix/> <strong>3.2.</strong> Traceability Matrix </a></ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/> <strong>4.</strong> Detailed Design </a> <ul><li class=active><a href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/data-interchange-design/> <strong>4.1.</strong> Data Interchange </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/back-end-design/> <strong>4.2.</strong> Back End </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/api-design/> <strong>4.3.</strong> API </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/web-application-design/> <strong>4.4.</strong> Web Application </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/database-design/> <strong>4.5.</strong> Database </a></ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/design-rationale/> <strong>5.</strong> Design Rationale </a> <ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/design-rationale/architecture-rationale/> <strong>5.1.</strong> Architecture </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/design-rationale/api-rationale/> <strong>5.2.</strong> API </a><li><a href=https://panevain.github.io/CS5744_TransitFlow/design-rationale/web-application-rationale/> <strong>5.3.</strong> Web Application </a></ul><li><a href=https://panevain.github.io/CS5744_TransitFlow/conclusion/> <strong>6.</strong> Conclusion </a></ul></nav></div><div class=page><div class=page__header><div class=menu-icon><span></span><span></span><span></span></div><span class=search-icon>🔎</span></div><div class=page__content><div class=search-container><input id=search placeholder=Search.. type=search><div class=search-results><div class=search-results__header></div><ul class=search-results__items></ul></div></div><div class=book-content><h1>Data Interchange</h1><p>The primary function of TransitFlow is to transfer data from data creators (buses) to data consumers (users on any public interface). Data in the TransitFlow system goes through a lifecycle that brings it through several different phases, beginning at the buses themselves and ending in long-term data storage servers. Between those stages, the data is sent from the buses to the central system to be stored in the live data cache, from which it can be retrieved by users through a variety of methods. Once the system receives new data from the bus, old data will be evicted from the cache and sent to long-term storage, where it will stay.<h2 id=data-creation>Data Creation</h2><p>Data begins life by being generated onboard one of the up to 24 buses that are in use by BT. This data consists of things like bus location in terms of latitude and longitude coordinates, bus heading, speed, most recent stop, number of passengers, and more. This data will also contain a key, which is the bus number. Once the data has been created, it is sent to the central TransitFlow application via the local cellular network.<h2 id=data-processing>Data Processing</h2><p>Once data is received by TransitFlow, some processing must occur to standardize the data. BT’s bus fleet is far from standardized, and very few of their buses were manufactured at the same time, resulting in buses that have different methods by which they send and organize data they generate<sup class=footnote-reference><a href=#1>1</a></sup>. Because of this, some processing must occur once the data is received by TransitFlow before it can be sent to users.<h2 id=data-retrieval>Data Retrieval</h2><p>Once data has been received by TransitFlow and the data processing has occurred, the bus state information is written to the database and cache(s). This data will be what is used to populate the live map and show users where buses are, what their last stop was, what route they are on, and how full they are. There are a few different ways that users will be able to retrieve this data: through the mobile application, through the web application, and through the SMS service.<h3 id=mobile-application>Mobile Application</h3><p>The primary method by which users currently retrieve information about the bus system is through the BT mobile application. The primary function of this app is to have a live map of all of the buses and the bus routes. This map will be populated by the app requesting the contents of the cache from TransitFlow, which will then be loaded in teh app itself. The cache will be sent through the internet and retrieved by the mobile device running the application either through Wi-Fi or a cellular network. The data will be sent as a JSON which is structured as an array, and each entry in the array will be the most recent data of a bus. The map itself will not be retrieved from TransitFlow or BT, but rather will be retrieved through the Google Maps API in order to save throughput from the TransitFlow servers. Every 15 seconds, the application will send a request to the server for new data, and the central server will send the contents of the cache again in a new JSON object.<h3 id=web-application>Web Application</h3><p>Another method by which users may retrieve bus information is through the web application hosted on the BT website, https://ridebt.org. This web application functions similarly to the mobile application, requesting the most recent bus data from the server on start and then sending a request for new data every 15 seconds. Data will again be transferred as a JSON array where each item in the array is the data for a different bus.<h3 id=sms-messaging>SMS Messaging</h3><p>Not everyone has a smartphone, and may not have access to a computer when they wish to receive bus information, so TransitFlow will provide an SMS system that users can use to retrieve data. This system will use Twilio to send and receive messages. Users can retrieve data by sending a message containing the unique stop code for a stop that they wish to receive information about. The system will receive that message, and using the stop code, will query the most up-to-date route information it has to compile a list of all bus routes that service that stop. The system will also query the route timetables to determine what the next time a bus servicing those routes will arrive at the stop, and include that information in a message sent to the user. All of this information will be sent as text in a text message.<h2 id=interchange-format>Interchange Format</h2><p>BT currently supplies information using a modified version of the <a rel="nofollow noreferrer" href=https://gtfs.org/>General Transit Feed Specification</a>, or GTFS. Each request is made to <code>https://ridebt.org/index.php?option=com_ajax&module=bt_map&format=json&Itemid=101&method={method}</code>. This is a truncated response where <code>method = getBuses</code>:<pre class=language-json data-lang=json style=background:#fafafa;color:#383a42><code class=language-json data-lang=json><span>{
</span><span>  </span><span style=color:#50a14f>"success"</span><span>: </span><span style=color:#c18401>true</span><span>,
</span><span>  </span><span style=color:#50a14f>"message"</span><span>: </span><span style=color:#c18401>null</span><span>,
</span><span>  </span><span style=color:#50a14f>"messages"</span><span>: </span><span style=color:#c18401>null</span><span>,
</span><span>  </span><span style=color:#50a14f>"data"</span><span>: [
</span><span>    {
</span><span>      </span><span style=color:#50a14f>"id"</span><span>: </span><span style=color:#50a14f>"6727"</span><span>,
</span><span>      </span><span style=color:#50a14f>"routeId"</span><span>: </span><span style=color:#50a14f>"TOM"</span><span>,
</span><span>      </span><span style=color:#50a14f>"stopId"</span><span>: </span><span style=color:#50a14f>"1312"</span><span>,
</span><span>      </span><span style=color:#50a14f>"patternName"</span><span>: </span><span style=color:#50a14f>"TOM via Progress"</span><span>,
</span><span>      </span><span style=color:#50a14f>"capacity"</span><span>: </span><span style=color:#50a14f>"0"</span><span>,
</span><span>      </span><span style=color:#50a14f>"percentOfCapacity"</span><span>: </span><span style=color:#50a14f>"0"</span><span>,
</span><span>      </span><span style=color:#50a14f>"tripStartOn"</span><span>: </span><span style=color:#c18401>1698605100000</span><span>,
</span><span>      </span><span style=color:#50a14f>"gtfsTripId"</span><span>: </span><span style=color:#50a14f>"57b9cc83-1d7c-4a5a-83bb-579517e3f62b"</span><span>,
</span><span>      </span><span style=color:#50a14f>"gtfsBlockId"</span><span>: </span><span style=color:#50a14f>"48f5cc9f-b86c-4b45-b98b-bc7a68ad2a42"</span><span>,
</span><span>      </span><span style=color:#50a14f>"states"</span><span>: [
</span><span>        {
</span><span>          </span><span style=color:#50a14f>"direction"</span><span>: </span><span style=color:#50a14f>"152"</span><span>,
</span><span>          </span><span style=color:#50a14f>"speed"</span><span>: </span><span style=color:#50a14f>"0"</span><span>,
</span><span>          </span><span style=color:#50a14f>"passengers"</span><span>: </span><span style=color:#50a14f>"0"</span><span>,
</span><span>          </span><span style=color:#50a14f>"isTimePoint"</span><span>: </span><span style=color:#50a14f>"N"</span><span>,
</span><span>          </span><span style=color:#50a14f>"isTripper"</span><span>: </span><span style=color:#50a14f>""</span><span>,
</span><span>          </span><span style=color:#50a14f>"isBusAtStop"</span><span>: </span><span style=color:#50a14f>"N"</span><span>,
</span><span>          </span><span style=color:#50a14f>"latitude"</span><span>: </span><span style=color:#c18401>37.2372188333333</span><span>,
</span><span>          </span><span style=color:#50a14f>"longitude"</span><span>: </span><span style=color:#c18401>-80.4348943333334</span><span>,
</span><span>          </span><span style=color:#50a14f>"realtimeLatitude"</span><span>: </span><span style=color:#c18401>37.2372188333333</span><span>,
</span><span>          </span><span style=color:#50a14f>"realtimeLongitude"</span><span>: </span><span style=color:#c18401>-80.4348943333334</span><span>,
</span><span>          </span><span style=color:#50a14f>"patternPointId"</span><span>: </span><span style=color:#c18401>0</span><span>,
</span><span>          </span><span style=color:#50a14f>"isProjected"</span><span>: </span><span style=color:#c18401>false</span><span>,
</span><span>          </span><span style=color:#50a14f>"isGenerated"</span><span>: </span><span style=color:#c18401>false</span><span>,
</span><span>          </span><span style=color:#50a14f>"version"</span><span>: </span><span style=color:#c18401>1698606258000
</span><span>        }
</span><span>      ]
</span><span>    }
</span><span>    </span><span style=color:#a0a1a7>// More buses...
</span><span>  ]
</span><span>}
</span></code></pre><p>The data rendered by the client is provided in array named <code>data</code>. Each bus has exactly one active state as shown by the only entry in the <code>states</code> array. Information about the route, pattern, and current bus state can be populated by the application server and stored in the cache.<p>The currently defined format has two quirks:<ul><li>The <code>message</code> and <code>messages</code> fields are currently unused and always return empty strings.<li>The success of a request is not indicated by the HTTP status code, but is instead indicated by the <code>success</code> field.</ul><p>This version of the interchange format is currently supported by all public clients except for SMS. In future versions of TransitFlow, it would be possible to remove these fields and use HTTP status codes once clients are updated to match.<h3 id=api-requests>API Requests:</h3><p>TransitFlow will provide a <a href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/api-design/>REST API</a> for users to be able to retrieve historical and current data about the BT system. This API will be publicly available, and will allow users to query the database to retrieve historical data about one or more bus, route, stop, or combination of the three. This data will be organized in a JSON object that will be sent to the user using HTTP, allowing the user to handle the data as they wish. The API will also provide a method by which users can pull the cache every 10 seconds to receive near real-time data.<h3 id=load-handling>Load Handling:</h3><p>With each data access method except for the SMS system, data can be requested by users every 10 seconds. This is so that the data that a user sees is as “fresh” as possible, but also on enough of a delay so that the system is not overwhelmed by requests from users. Because peak loads can exceed 10 thousand users, the system will constantly be receiving requests, so having a point of access limited to one request every 10 seconds reduces the amount of requests handled by the system to a reasonable amount in order to reduce the time that a user must wait to have their request fulfilled.<div class=footnote-definition id=1><sup class=footnote-definition-label>1</sup><p><a rel="nofollow noreferrer" href=https://ridebt.org>Blacksburg Transit System Information</a> (From a conversation Matthew Averyt and Matthew Newcomer had with BT customer service employees on 24 October 2023)</div></div></div><div class=prev-link><a class=previous href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/><</a></div><div class=next-link><a class=next href=https://panevain.github.io/CS5744_TransitFlow/detailed-design/back-end-design/>></a></div></div><script src=https://panevain.github.io/CS5744_TransitFlow/elasticlunr.min.js></script><script src=https://panevain.github.io/CS5744_TransitFlow/search_index.en.js></script><script src=https://panevain.github.io/CS5744_TransitFlow/book.js></script>